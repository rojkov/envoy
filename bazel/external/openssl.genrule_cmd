#!/bin/bash

set -e

# Bazel magic.
# ROOT=external/com_github_openssl/openssl-OpenSSL_1_1_1b
ROOT=$$(dirname $(execpath openssl-OpenSSL_1_1_1b/NOTES.ANDROID))
pushd $$ROOT

echo "Installing into $$(pwd)/install"
./config --prefix=$$(pwd)/install 2>&1
make -j$$(nproc)
make install

# Move compiled libraries to the expected destinations.
popd
find $$ROOT/install
mv $$ROOT/install/include $$(dirname $(location include/openssl/ssl.h))/../../
mv $$ROOT/install/lib $$(dirname $(location lib/libssl.a))/../
